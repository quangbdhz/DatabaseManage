thiếu xóa database, thiếu thêm cột table, thiếu chi tiếc database









from my_app.common import *

@app.route("/create-column-table")
def column():
    form = CreateTableForm()
    return render_template("Database/column-table.html", form=form)


@app.route("/create-table")
def table():
    form = CreateTableForm()

    rds_host = "dbtest.cctxaxqlrtny.us-east-1.rds.amazonaws.com"
    name = "admin"
    password = "quang810"
    db_name = ""

    try:
        conn = pymysql.connect(host=rds_host, user=name, passwd=password, db=db_name, connect_timeout=5)
    except pymysql.MySQLError as e:
        print(e)
        sys.exit()

    try:
        with conn.cursor() as cur:
            query = "SHOW DATABASES"
            cur.execute(query)
            data = cur.fetchall()
        conn.commit()
    except Exception as e:
        print(e)
    dataTypeTable = ()
    try:
        with conn.cursor() as cur:
            query = "SELECT * FROM ManageUser.TypeTable"
            cur.execute(query)
            dataTypeTable = cur.fetchall()
        conn.commit()
    except Exception as e:
        print(e)

    return render_template("Database/create-table.html", form=form, data=data, dataTypeTable=dataTypeTable)


@app.route("/database/create-database", methods=["POST"])
def create_database():
    form = CreateTableForm()
    getNamDatabase = ""
    if request.method == "POST":
        form = CreateTableForm()
        getNamDatabase = ""
        if request.method == "POST":
            getNamDatabase = request.form.get('nameDatabase')
            url = "https://sqs.us-east-1.amazonaws.com/126581837666/testQueue"
            headers = {"Content-Type": "application/x-www-form-urlencoded"}

            payload = {
                "name_database": getNamDatabase
            }
            payload = quote(str(payload))
            params = {
                'Action': 'SendMessage',
                'MessageBody': payload
            }
            send = requests.post(url, headers=headers, params=params)
        return redirect(url_for('table'))


@app.route("/database/create-table", methods=["POST", "GET"])
def create_table():
    form = CreateTableForm()
    select = request.form.get('choose_database')
    getChooseDatabase = ""
    for item in select:
        if item == "(" or item == ")" or item == "'" or item == ",":
            continue
        else:
            getChooseDatabase += item

    getNameTable = request.form.get('nameTable')
    getNameColumn = request.form.get('nameColumnTable')
    getTypeColumn = request.form.get('chooseTypeColumn')

    if request.method == "POST":
        form = CreateTableForm()

        if request.method == "POST":
            url = "https://sqs.us-east-1.amazonaws.com/126581837666/QueueCreateTableDatabase"
            headers = {"Content-Type": "application/x-www-form-urlencoded"}

            payload = {
                "name_database": getChooseDatabase,
                "name_table": getNameTable,
                "name_column": getNameColumn,
                "type": getTypeColumn,
            }
            payload = quote(str(payload))
            params = {
                'Action': 'SendMessage',
                'MessageBody': payload
            }
            send = requests.post(url, headers=headers, params=params)
        return redirect(url_for('column'))

    # return render_template("Database/create-table.html", form=form, Test = getTypeColumn)
    # if request.method == "POST":
    #     return redirect(url_for('database'))


@app.route("/database", methods=["POST", "GET"])
def database():
    form = CreateTableForm()
    return render_template("Database/index.html", form=form)